flowchart TB
    subgraph Input["1. Input Data"]
        direction LR
        A1["Cell Type 1\nGene Expression"] --> FP
        A2["Cell Type 2\nGene Expression"] --> FP
        style A1 fill:#f9e6e6
        style A2 fill:#f9e6e6
    end

    subgraph Feature["2. Feature Engineering"]
        direction TB
        FP["Feature Preparation"] --> F1["Basic Features"]
        FP --> F2["Interaction Features"]
        FP --> F3["Correlation Features"]
        F1 & F2 & F3 --> CM["Combined Matrix"]
        style FP fill:#e6f3ff
        style F1 fill:#e6f3ff
        style F2 fill:#e6f3ff
        style F3 fill:#e6f3ff
        style CM fill:#e6f3ff
    end

    subgraph Model["3. Model Training"]
        direction TB
        CM --> RF["Random Forest Model"]
        CM --> XGB["XGBoost Model"]
        RF --> EP["Ensemble\nPredictions"]
        XGB --> EP
        style RF fill:#e6ffe6
        style XGB fill:#e6ffe6
        style EP fill:#e6ffe6
    end

    subgraph Evaluation["4. Model Evaluation"]
        direction TB
        EP --> M1["ROC Curve\nAUC Score"]
        EP --> M2["PR Curve\nPrecision/Recall"]
        EP --> M3["Feature\nImportance Analysis"]
        EP --> M4["FDR Control\n(p < 0.05)"]
        style M1 fill:#fff5e6
        style M2 fill:#fff5e6
        style M3 fill:#fff5e6
        style M4 fill:#fff5e6
    end

    subgraph Output["5. Final Results"]
        direction TB
        M1 & M2 & M3 & M4 --> R1["Model Performance\nMetrics"]
        M1 & M2 & M3 & M4 --> R2["Significant\nInteractions"]
        style R1 fill:#e6e6ff
        style R2 fill:#e6e6ff
    end

    %% 整体样式设置
    classDef section fill:#fff,stroke:#333,stroke-width:2px
    class Input,Feature,Model,Evaluation,Output section
    
    %% 连接线样式
    linkStyle default stroke:#666,stroke-width:2px